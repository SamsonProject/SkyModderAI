<div id="share-button-container" class="share-button-container">
    <button id="share-button" class="share-button">
        <i class="fas fa-share-alt"></i>
        <span>Share Load Order</span>
    </button>
    
    <div id="share-modal" class="share-modal">
        <div class="share-modal-content">
            <div class="share-modal-header">
                <h3>Share Your Load Order</h3>
                <button class="close-button">&times;</button>
            </div>
            
            <div class="share-modal-body">
                <div class="form-group">
                    <label for="share-title">Title (optional)</label>
                    <input type="text" id="share-title" class="form-control" placeholder="E.g., My Skyrim SE Mod List">
                </div>
                
                <div class="form-group">
                    <label for="share-notes">Notes (optional)</label>
                    <textarea id="share-notes" class="form-control" rows="3" placeholder="Add any notes about your mod list..."></textarea>
                </div>
                
                <div class="form-group">
                    <label class="checkbox-container">
                        <input type="checkbox" id="share-public" checked>
                        <span class="checkmark"></span>
                        <span>Make public (show in your profile)</span>
                    </label>
                    <p class="hint">Uncheck to create an unlisted link that won't appear in your profile</p>
                </div>
                
                <div id="share-result" class="share-result" style="display: none;">
                    <div class="alert alert-success">
                        <i class="fas fa-check-circle"></i>
                        <div>
                            <strong>Share link created!</strong>
                            <p>Copy the link below to share your load order:</p>
                            <div class="share-link-container">
                                <input type="text" id="share-link" class="form-control" readonly>
                                <button id="copy-share-link" class="btn-copy" title="Copy to clipboard">
                                    <i class="far fa-copy"></i>
                                </button>
                            </div>
                            <p class="share-expires">This link will expire in 30 days</p>
                        </div>
                    </div>
                </div>
                
                <div id="share-error" class="alert alert-danger" style="display: none;">
                    <i class="fas fa-exclamation-circle"></i>
                    <div>
                        <strong>Error creating share link</strong>
                        <p id="share-error-message">An unknown error occurred. Please try again.</p>
                    </div>
                </div>
            </div>
            
            <div class="share-modal-footer">
                <button id="cancel-share" class="btn btn-secondary">Cancel</button>
                <button id="create-share" class="btn btn-primary">
                    <span class="button-text">Create Share Link</span>
                    <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true" style="display: none;"></span>
                </button>
            </div>
        </div>
    </div>
</div>

<style>
.share-button-container {
    position: relative;
    display: inline-block;
}

.share-button {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background-color: #4a90e2;
    color: white;
    border: none;
    border-radius: 4px;
    font-size: 0.9rem;
    font-weight: 500;
    cursor: pointer;
    transition: background-color 0.2s;
}

.share-button:hover {
    background-color: #3a7bc8;
}

.share-button i {
    font-size: 1.1em;
}

.share-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    justify-content: center;
    align-items: center;
    opacity: 0;
    transition: opacity 0.3s;
}

.share-modal.show {
    display: flex;
    opacity: 1;
}

.share-modal-content {
    background-color: white;
    border-radius: 8px;
    width: 100%;
    max-width: 500px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    transform: translateY(20px);
    transition: transform 0.3s;
}

.share-modal.show .share-modal-content {
    transform: translateY(0);
}

.share-modal-header {
    padding: 1.25rem 1.5rem;
    border-bottom: 1px solid #e2e8f0;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.share-modal-header h3 {
    margin: 0;
    font-size: 1.25rem;
    color: #2d3748;
}

.close-button {
    background: none;
    border: none;
    font-size: 1.5rem;
    color: #718096;
    cursor: pointer;
    padding: 0.25rem;
    line-height: 1;
}

.close-button:hover {
    color: #2d3748;
}

.share-modal-body {
    padding: 1.5rem;
}

.form-group {
    margin-bottom: 1.25rem;
}

.form-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 500;
    color: #4a5568;
}

.form-control {
    width: 100%;
    padding: 0.5rem 0.75rem;
    border: 1px solid #e2e8f0;
    border-radius: 4px;
    font-size: 0.95rem;
    transition: border-color 0.2s, box-shadow 0.2s;
}

.form-control:focus {
    border-color: #4a90e2;
    outline: none;
    box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.2);
}

textarea.form-control {
    min-height: 80px;
    resize: vertical;
}

.checkbox-container {
    display: block;
    position: relative;
    padding-left: 30px;
    margin-bottom: 0.5rem;
    cursor: pointer;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}

.checkbox-container input {
    position: absolute;
    opacity: 0;
    cursor: pointer;
    height: 0;
    width: 0;
}

.checkmark {
    position: absolute;
    top: 0;
    left: 0;
    height: 20px;
    width: 20px;
    background-color: #fff;
    border: 1px solid #cbd5e0;
    border-radius: 4px;
    transition: all 0.2s;
}

.checkbox-container:hover input ~ .checkmark {
    background-color: #f7fafc;
}

.checkbox-container input:checked ~ .checkmark {
    background-color: #4a90e2;
    border-color: #4a90e2;
}

.checkmark:after {
    content: "";
    position: absolute;
    display: none;
}

.checkbox-container input:checked ~ .checkmark:after {
    display: block;
}

.checkbox-container .checkmark:after {
    left: 7px;
    top: 3px;
    width: 5px;
    height: 10px;
    border: solid white;
    border-width: 0 2px 2px 0;
    transform: rotate(45deg);
}

.hint {
    font-size: 0.8rem;
    color: #718096;
    margin: 0.25rem 0 0 0;
}

.share-result {
    margin: 1.5rem 0;
}

.alert {
    padding: 1rem;
    border-radius: 4px;
    display: flex;
    gap: 0.75rem;
    align-items: flex-start;
}

.alert i {
    font-size: 1.25rem;
    margin-top: 0.1rem;
}

.alert-success {
    background-color: #f0fdf4;
    border-left: 4px solid #10b981;
}

.alert-danger {
    background-color: #fef2f2;
    border-left: 4px solid #ef4444;
}

.alert strong {
    display: block;
    margin-bottom: 0.25rem;
}

.alert p {
    margin: 0.25rem 0 0 0;
    font-size: 0.9rem;
    color: #4b5563;
}

.share-link-container {
    display: flex;
    margin: 0.75rem 0;
    gap: 0.5rem;
}

.share-link-container input {
    flex-grow: 1;
    background-color: #f9fafb;
    border: 1px solid #e5e7eb;
    padding: 0.5rem 0.75rem;
    border-radius: 4px;
    font-size: 0.9rem;
    color: #4b5563;
}

.btn-copy {
    background-color: #f3f4f6;
    border: 1px solid #e5e7eb;
    border-radius: 4px;
    padding: 0 0.75rem;
    color: #4b5563;
    cursor: pointer;
    transition: all 0.2s;
}

.btn-copy:hover {
    background-color: #e5e7eb;
}

.share-expires {
    font-size: 0.8rem;
    color: #6b7280;
    margin: 0.5rem 0 0 0;
    font-style: italic;
}

.share-modal-footer {
    padding: 1rem 1.5rem;
    border-top: 1px solid #e2e8f0;
    display: flex;
    justify-content: flex-end;
    gap: 0.75rem;
}

.btn {
    padding: 0.5rem 1rem;
    border-radius: 4px;
    font-weight: 500;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.2s;
    border: 1px solid transparent;
}

.btn-primary {
    background-color: #4a90e2;
    color: white;
    border-color: #4a90e2;
}

.btn-primary:hover {
    background-color: #3a7bc8;
    border-color: #3a7bc8;
}

.btn-secondary {
    background-color: #f3f4f6;
    color: #4b5563;
    border-color: #e5e7eb;
}

.btn-secondary:hover {
    background-color: #e5e7eb;
}

/* Responsive styles */
@media (max-width: 600px) {
    .share-modal-content {
        width: 95%;
        margin: 1rem;
        max-height: 90vh;
    }
    
    .share-modal-header {
        padding: 1rem;
    }
    
    .share-modal-body {
        padding: 1rem;
    }
    
    .share-modal-footer {
        padding: 1rem;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const shareButton = document.getElementById('share-button');
    const shareModal = document.getElementById('share-modal');
    const closeButton = document.querySelector('.close-button');
    const cancelButton = document.getElementById('cancel-share');
    const createButton = document.getElementById('create-share');
    const shareResult = document.getElementById('share-result');
    const shareError = document.getElementById('share-error');
    const shareLink = document.getElementById('share-link');
    const copyButton = document.getElementById('copy-share-link');
    
    // Open modal when share button is clicked
    if (shareButton) {
        shareButton.addEventListener('click', function() {
            shareModal.classList.add('show');
            document.body.style.overflow = 'hidden'; // Prevent scrolling
        });
    }
    
    // Close modal functions
    function closeModal() {
        shareModal.classList.remove('show');
        document.body.style.overflow = ''; // Re-enable scrolling
    }
    
    // Close modal when clicking the close button, cancel button, or outside the modal
    if (closeButton) closeButton.addEventListener('click', closeModal);
    if (cancelButton) cancelButton.addEventListener('click', closeModal);
    
    shareModal.addEventListener('click', function(e) {
        if (e.target === shareModal) {
            closeModal();
        }
    });
    
    // Handle share creation
    if (createButton) {
        createButton.addEventListener('click', async function() {
            const buttonText = createButton.querySelector('.button-text');
            const spinner = createButton.querySelector('.spinner-border');
            
            // Show loading state
            buttonText.textContent = 'Creating...';
            spinner.style.display = 'inline-block';
            createButton.disabled = true;
            
            // Hide any previous results/errors
            shareResult.style.display = 'none';
            shareError.style.display = 'none';
            
            try {
                // Get the current game and mod list
                const gameId = document.querySelector('.game-selector')?.value || 'skyrimse';
                const modList = [];
                
                // Get mods from the current view (this is a simplified example)
                // You'll need to adjust this based on how your mod list is structured
                document.querySelectorAll('.mod-item').forEach(modItem => {
                    const name = modItem.querySelector('.mod-name')?.textContent.trim();
                    const version = modItem.querySelector('.mod-version')?.textContent.trim();
                    
                    if (name) {
                        modList.push({
                            name: name,
                            version: version || null
                        });
                    }
                });
                
                if (modList.length === 0) {
                    throw new Error('No mods found to share');
                }
                
                // Get analysis results (if any)
                const analysisResults = {}; // You'll need to get this from your app's state
                
                // Create the share
                const response = await fetch('/api/load-order/share', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    credentials: 'same-origin',
                    body: JSON.stringify({
                        game: gameId,
                        game_version: document.querySelector('.game-version')?.textContent.trim() || null,
                        masterlist_version: document.querySelector('.masterlist-version')?.textContent.trim() || null,
                        mod_list: modList,
                        analysis_results: analysisResults,
                        title: document.getElementById('share-title').value.trim() || null,
                        notes: document.getElementById('share-notes').value.trim() || null,
                        is_public: document.getElementById('share-public').checked
                    })
                });
                
                if (!response.ok) {
                    const error = await response.json().catch(() => ({}));
                    throw new Error(error.message || 'Failed to create share link');
                }
                
                const data = await response.json();
                
                // Show success message with share link
                shareLink.value = data.share_url;
                shareResult.style.display = 'block';
                
                // Scroll to the result
                shareResult.scrollIntoView({ behavior: 'smooth' });
                
            } catch (error) {
                console.error('Error creating share link:', error);
                
                // Show error message
                const errorMessage = document.getElementById('share-error-message');
                errorMessage.textContent = error.message || 'An unknown error occurred. Please try again.';
                shareError.style.display = 'flex';
                
                // Scroll to the error
                shareError.scrollIntoView({ behavior: 'smooth' });
                
            } finally {
                // Reset button state
                buttonText.textContent = 'Create Share Link';
                spinner.style.display = 'none';
                createButton.disabled = false;
            }
        });
    }
    
    // Copy share link to clipboard
    if (copyButton) {
        copyButton.addEventListener('click', function() {
            shareLink.select();
            document.execCommand('copy');
            
            // Show copied feedback
            const originalTitle = copyButton.getAttribute('title');
            copyButton.setAttribute('title', 'Copied!');
            copyButton.innerHTML = '<i class="fas fa-check"></i>';
            
            // Reset after 2 seconds
            setTimeout(() => {
                copyButton.setAttribute('title', originalTitle);
                copyButton.innerHTML = '<i class="far fa-copy"></i>';
            }, 2000);
        });
    }
    
    // Close modal with Escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && shareModal.classList.contains('show')) {
            closeModal();
        }
    });
});
</script>
